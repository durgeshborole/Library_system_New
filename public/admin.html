<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Library System</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
  <header class="mit-header">
    <img src="./images/mit-corer.jpg" alt="MITCORER Logo" class="mit-logo" />
    <div class="header-text">
      <p class="sub-text">Under the aegis of MAEER's MIT Pune</p>
      <h1>MIT COLLEGE OF RAILWAY ENGINEERING & RESEARCH, Barshi</h1>
      <p class="aff-text">
        Affiliated to Punyashlok Ahilyadevi Holkar Solapur University (PAH) Solapur, Approved by AICTE, New Delhi,
        Recognised by Govt. Of Maharashtra, DTE Mumbai.<br />
        <strong>DTE CODE - 06901</strong>
      </p>
    </div>
  </header>

  <nav class="navbar">
    <div class="logo">Admin </div>
    <ul class="nav-links">
      <li><a href="dashboard.html">Home</a></li>
      <li><a href="log.html">Logs Entries</a></li>
      <li><a href="analysis.html">Analysis</a></li>




    </ul>

    <div class="profile-container">
      <a href="index.html" class="nav-button" id="loginBtn">Login</a>
      <div class="profile" id="profileMenu" style="display: none;">
        <img src="./images/profile-icon.jpg" alt="Profile" class="profile-icon" id="profileIcon" />
        <div class="profile-dropdown" id="profileDropdown">
          <div class="profile-details">
            <p class="profile-name">Administrator</p>
            <p class="profile-email">email@example.com</p>
          </div>
          <a href="#" class="logout-btn" id="logoutBtn">Logout</a>
        </div>
      </div>
    </div>
  </nav>



  <main class="dashboard">
    <section class="card">
      <h3>â° Auto Exit Schedule</h3>
      <label for="autoExitHour">Hour:</label>
      <input type="number" id="autoExitHour" min="0" max="23" placeholder="e.g. 21 for 9 PM" />

      <label for="autoExitMinute">Minute:</label>
      <input type="number" id="autoExitMinute" min="0" max="59" placeholder="e.g. 0" />

      <button onclick="updateAutoExit()">Update Time</button>
    </section>

    <section class="card">
      <h3>ğŸ” Force Manual Exit</h3>
      <p>This will mark all visitors currently inside as exited.</p>
      <button onclick="forceExit()">Force Exit All</button>
    </section>

    <section class="card">
      <h3>ğŸ“¥ Export Logs</h3>
      <p>Download visitor logs in CSV format.</p>
      <button onclick="exportLogs('today')">Export Today's Logs</button>
      <button onclick="exportLogs('all')">Export All Logs</button>
    </section>

    <section class="card">
      <h3>ğŸ‘¤ Registered Users</h3>
      <p>Add students and staff registered in the system.</p>
      <button onclick="location.href='add-users.html'">Add Users</button>
    </section>

    <section class="card">
      <h3>ğŸ“¢ Add Library Notice</h3>
      <p>Post a new notice visible on the homepage.</p>
      <textarea id="noticeText" rows="4" placeholder="Enter notice text..."></textarea>
      <button onclick="submitNotice()">Post Notice</button>
    </section>

    <section class="card">
      <h3>ğŸ–¼ï¸ Upload Visitor Photo</h3>
      <input type="text" id="photoBarcode" placeholder="Enter Barcode" />
      <input type="file" id="photoFile" accept="image/*" />
      <button onclick="uploadPhoto()">Upload Photo</button>
    </section>

    <section class="card">
      <h3>ğŸ–¼ï¸ Bulk Upload Visitor Photos</h3>
      <input type="file" id="bulkPhotoFiles" accept="image/*" multiple />
      <button onclick="bulkUploadPhotos()">Bulk Upload</button>
    </section>

    <section class="card">
      <h3>ğŸ—‘ï¸ Manage Library Notices</h3>
      <ul id="adminNoticeList">
        <li>Loading notices...</li>
      </ul>
    </section>

    <section class="card">
      <h3>ğŸ† Monthly Awards</h3>
      <p>See the most regular visitor and the most active department this month.</p>
      <!-- <button onclick="loadMonthlyAwards()">Refresh Awards</button> -->
      <button onclick="location.href='awards.html'">See Awards</button>

    </section>

    <section class="card">
      <h3>Register Hod</h3>
      <p>Register a new Head of Department.</p>
      <button onclick="location.href='register-hod.html'">Register</button>
    </section>

    <section class="dashboard-grid">
      <div class="card">
        <h3>Manage HODs</h3>
        <p style="font-size: 1rem; color: #666;">View, create, update, and delete Head of Department accounts.</p>
        <button onclick="location.href='manage-hods.html'">Go to HOD Management</button>
      </div>
    </section>

    <section class="card">
      <h3>Register Principal</h3>
      <p>Create a new account for the Principal.</p>
      <button onclick="location.href='register-principal.html'">Register Hod</button>
    </section>

    <section class="card">
      <h3>Advanced Reports</h3>
      <p>Generate custom reports with charts and graphs.</p>
      <button onclick="location.href='reports.html'">View Reports</button>
    </section>

    <section class="card">
      <h3>Register Admin</h3>
      <p>Create a new account for the Admin.</p>
      <button onclick="location.href='register.html'">Register Admin</button>
    </section>

    <section class="card">
      <h3>ğŸ“ Academic Year Promotions</h3>
      <p>Upload a list of failed students to hold them back for the current academic year.</p>
      <button onclick="location.href='academic-update.html'">Update Promotions</button>
    </section>

    <section class="card">
      <h3>âš™ï¸ Data Utilities</h3>
      <p>Run special tools to repair or maintain database records.</p>
      <button onclick="location.href='fix-data.html'">Go to Data Fix Tools</button>
    </section>

    <section class="card">
      <h2>Manage Departments</h2>
      <input type="text" id="deptCode" placeholder="Code (e.g. 6)">
      <input type="text" id="deptName" placeholder="Department Name">
      <button onclick="addDepartment()">Add Department</button>
    </section>

    <section class="card">
      <h2>Manage Designations</h2>
      <input type="text" id="desgCode" placeholder="Code (e.g. R)">
      <input type="text" id="desgName" placeholder="Designation Name">
      <button onclick="addDesignation()">Add Designation</button>
    </section>


    <section class="card">
      <h3>Register Assistant</h3>
      <p>Create a new account for log entry assistants.</p>
      <button onclick="location.href='register-assistant.html'">Register Assistant</button>
    </section>

    <section class="card">
      <h3>ğŸ“¥ Inbox (Complaints & Suggestions)</h3>
      <ul id="messageList" style="list-style-type: none; padding: 0; max-height: 400px; overflow-y: auto;">
        <li>Loading messages...</li>
      </ul>
    </section>








  </main>


  <footer class="footer">
    <p>Admin Dashboard | Developed by MITCORER Team</p>
  </footer>

  <script src="./js/admin.js"></script>
</body>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const authToken = sessionStorage.getItem('authToken');
    if (!authToken) {
      // If no token is found, immediately redirect to the login page
      window.location.href = 'index.html';
      return; // Stop the rest of the script from running
    }

    // --- Original Page Logic (only runs if the user is logged in) ---
    const loginBtn = document.getElementById('loginBtn');
    const profileMenu = document.getElementById('profileMenu');
    const profileIcon = document.getElementById('profileIcon');
    const profileDropdown = document.getElementById('profileDropdown');
    const logoutBtn = document.getElementById('logoutBtn');

    // This logic now only runs for authenticated users
    const adminEmail = sessionStorage.getItem('adminEmail'); // Or userEmail, etc.

    if (adminEmail) {
      loginBtn.style.display = 'none';
      profileMenu.style.display = 'block';
      document.querySelector('.profile-email').textContent = adminEmail;
    } else {
      // This case should ideally not be reached because of the gatekeeper
      loginBtn.style.display = 'block';
      profileMenu.style.display = 'none';
    }

    profileIcon.addEventListener('click', (event) => {
      profileDropdown.classList.toggle('show');
      event.stopPropagation();
    });

    window.addEventListener('click', () => {
      if (profileDropdown.classList.contains('show')) {
        profileDropdown.classList.remove('show');
      }
    });

    logoutBtn.addEventListener('click', (event) => {
      event.preventDefault();
      sessionStorage.removeItem('authToken');
      sessionStorage.removeItem('adminEmail');
      alert('You have been logged out.');
      window.location.href = 'index.html';
    });
  });
</script>


</html>